var Calendar=function(t){this.divElement,this.table=[],this.monthTable=[],this.calendarElement,this.size={width:t.width,height:t.height},this.button={},this.panel,this.nowDate=new Date(Date.now()),this.pageDate=this.nowDate,this.dateInfo={date:0,month:0,year:0,dateOfMonth:0,dayOfWeek:0,firstDayOfThisMonth:0},this.calendarElement=this.createCalendar(),this.panel=this.createPanel(),this.monthPanel=this.createMonthPanel(),this.setFontSize(),this.setDateInformation(this.nowDate,this.dateInfo),this.calendarFill(this.dateInfo,this.table),this.bind()};Calendar.prototype.createCalendar=function(){if(!document.getElementById)return!1;if(!document.getElementById("lucas-calendar"))return!1;this.divElement=document.getElementById("lucas-calendar");var t=document.createElement("input");return t.setAttribute("class","lucas-calendar"),t.setAttribute("name","lucas-calendar"),this.divElement.appendChild(t),t},Calendar.prototype.setFontSize=function(){this.divElement.style.width=this.size.width,this.calendarElement.style.width=this.size.width,this.calendarElement.style.height=this.size.height,this.calendarElement.style.fontSize=.6*parseInt(this.size.height)+"px",this.panel.style.fontSize=window.getComputedStyle(this.table[1],null).height},Calendar.prototype.createPanel=function(){var t=document.createElement("div");return t.setAttribute("class","lucas-calendar-panel"),t.setAttribute("name","lucas-calendar-panel"),t.style.width=1.01*parseInt(this.size.width)+"px",t.style.height=1.2*parseInt(this.size.width)+"px",this.divElement.appendChild(t),this.createButton(this.button,t),this.createContent(t,7,7),$(t).hide(),t},Calendar.prototype.createButton=function(t,e){var a=document.createElement("div");a.setAttribute("class","lucas-calendar-buttonGroup"),a.setAttribute("name","lucas-calendar-buttonGroup"),e.appendChild(a),this.createButtonHelp("left",t,a),this.createButtonHelp("right",t,a),this.createButtonHelp("YandM",t,a)},Calendar.prototype.createButtonHelp=function(t,e,a){e[t]=document.createElement("button"),e[t].setAttribute("class","calendar-button-"+t),a.appendChild(e[t])},Calendar.prototype.createContent=function(t,e,a){var n,i,l,o=document.createElement("table"),r=[],d=1,s=["一","二","三","四","五","六","日"];o.setAttribute("cellspacing",0),o.setAttribute("cellpadding",0),n=document.createElement("tbody"),i=document.createElement("thead");for(var c=0;e>c;c++)if(0===c){r[c]=document.createElement("tr");for(var h=0;a>h;h++)l=document.createElement("th"),l.textContent=s[h],r[c].appendChild(l);i.appendChild(r[c]),o.appendChild(i)}else{r[c]=document.createElement("tr"),n.appendChild(r[c]);for(var u=0;a>u;u++)l=document.createElement("td"),r[c].appendChild(l),this.table[d++]=l}o.appendChild(n),t.appendChild(o)},Calendar.prototype.createMonthPanel=function(){var t=document.createElement("div");return t.setAttribute("class","lucas-calendar-monthPanel"),t.setAttribute("name","lucas-calendar-monthPanel"),t.style.width=1.01*parseInt(this.size.width)+"px",t.style.height=.9*parseInt(this.size.width)+"px",this.divElement.appendChild(t),$(t).hide(),this.createMButton(this.button,t),this.createMonthContent(t,3,4),t},Calendar.prototype.createMonthContent=function(t,e,a){var n=document.createElement("table"),i=[],l=document.createElement("tbody"),o=1;n.setAttribute("cellspacing",0),n.setAttribute("cellpadding",0);for(var r=0;e>r;r++){i[r]=document.createElement("tr");for(var d=0;a>d;d++)this.monthTable[o]=document.createElement("td"),this.monthTable[o].textContent=o+"月",i[r].appendChild(this.monthTable[o++]);l.appendChild(i[r])}n.appendChild(l),t.appendChild(n)},Calendar.prototype.createMButton=function(t,e){var a=document.createElement("div");a.setAttribute("class","lucas-calendar-buttonGroup"),a.setAttribute("name","lucas-calendar-buttonGroup"),e.appendChild(a),this.createButtonHelp("mleft",t,a),this.createButtonHelp("mright",t,a),this.createButtonHelp("month",t,a)},Calendar.prototype.bind=function(){var t=this;this.calendarElement.addEventListener("focus",function(e){$("#lucas-calendar").find(".lucas-calendar-panel").fadeIn(800,"linear"),t.setDateInformation(t.pageDate,t.dateInfo)}),$(document).bind("click",function(t){var e=$(t.target);0==e.closest("#lucas-calendar").length&&$("#lucas-calendar").find(".lucas-calendar-panel").fadeOut("slow"),t.stopPropagation()}),$("#lucas-calendar").on("mouseenter mouseleave","td,th",function(t){"mouseenter"===t.type?$(this).css("border-color","white"):$(this).css("border-color","#343434")}),this.button.left.addEventListener("click",function(e){t.pageDate.setMonth(t.dateInfo.month-2),t.setDateInformation(t.pageDate,t.dateInfo),t.calendarFill(t.dateInfo,t.table)}),this.button.right.addEventListener("click",function(e){t.pageDate.setMonth(t.dateInfo.month),t.setDateInformation(t.pageDate,t.dateInfo),t.calendarFill(t.dateInfo,t.table)}),this.button.mleft.addEventListener("click",function(e){t.pageDate.setYear(t.dateInfo.year-1),t.setDateInformation(t.pageDate,t.dateInfo),t.calendarFill(t.dateInfo,t.table)}),this.button.mright.addEventListener("click",function(e){t.pageDate.setYear(t.dateInfo.year+1),t.setDateInformation(t.pageDate,t.dateInfo),t.calendarFill(t.dateInfo,t.table)}),this.button.YandM.addEventListener("click",function(t){$(".lucas-calendar-panel").animate({height:"toggle",opacity:"toggle"},400,"linear").promise().done(function(){$(".lucas-calendar-monthPanel").animate({height:"toggle",opacity:"toggle"},400,"linear")})});for(var e=1;e<this.table.length;e++)!function(t){t.table[e].addEventListener("click",function(e){var a,n;a=t.dateInfo.month<10?"0"+t.dateInfo.month:t.dateInfo.month,n=e.target.textContent<10?"0"+e.target.textContent:e.target.textContent;var i=t.dateInfo.year+"-"+a+"-"+n;""===e.target.textContent&&(i=""),t.calendarElement.value=i,$("#lucas-calendar").find(".lucas-calendar-panel").fadeOut("slow")})}(this);for(var a=1;a<this.monthTable.length;a++)!function(t){t.monthTable[a].addEventListener("click",function(e){t.pageDate.setMonth(parseInt(e.target.textContent)-1),t.setDateInformation(t.pageDate,t.dateInfo),t.calendarFill(t.dateInfo,t.table),$(".lucas-calendar-monthPanel").animate({height:"toggle",opacity:"toggle"},400,"linear").promise().done(function(){$(".lucas-calendar-panel").animate({height:"toggle",opacity:"toggle"},400,"linear")})})}(this)},Calendar.prototype.setDateInformation=function(t,e){switch(e.date=t.getDate(),e.month=t.getMonth()+1,e.year=t.getYear()+1900,e.dayOfWeek=t.getDay(),e.month){case 1:case 3:case 5:case 7:case 8:case 10:case 12:e.dateOfMonth=31;break;case 4:case 6:case 9:case 11:e.dateOfMonth=30;break;case 2:e.year%4===0?e.dateOfMonth=29:e.dateOfMonth=28}var a=t;a.setDate(1),e.firstDayOfThisMonth=a.getDay()?a.getDay():7},Calendar.prototype.calendarFill=function(t,e){for(var a=1;a<e.length;a++)e[a].textContent="";for(var n=0;n<t.dateOfMonth;n++)e[t.firstDayOfThisMonth+n].textContent=n+1;this.button.YandM.textContent=t.year+"年"+t.month+"月",this.button.month.textContent=t.year+"年"}
